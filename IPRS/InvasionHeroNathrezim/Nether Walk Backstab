/*
UNFINISHED CHECK LATER
*/

// ACTIONS ====================================================

function Nether_Walk_Bash takes nothing returns nothing

  local unit caster = GetEventDamageSource()
  local unit target = GetTriggerUnit()
  local integer casterOwner = GetPlayerId (GetOwningPlayer (caster))
  local real x = GetUnitX (caster)
  local real y = GetUnitY (caster)
  local unit temp = CreateUnit (Player(casterOwner), 'h001', x, y, 0)

  call UnitAddAbility     (temp, sleep)
  call IssueTargetOrder   (temp, sleep, target)
  call UnitApplyTimedLife (temp, 'BTLF', 3)

  set caster = null
  set target = null
  set temp   = null

endfunction

function Nether_Walk_A takes nothing returns nothing

  local integer netherWalkBash = 'A000'
  call UnitAddAbility       (GetTriggerUnit(), netherWalkBash)
  call BlzUnitHideAbility   (GetTriggerUnit(), netherWalkBash, true)

endfunction

// CONDITIONS =================================================

function Nether_Walk_Wake_C takes nothing returns boolean
  return GetUnitAbilityLevel (GetTriggerUnit(), NetherWalkSleep) > 0
endfunction

function Nether_Walk_Bash_C takes nothing returns boolean
  local boolean b = not GetUnitAbilityLevel (GetEventDamageSource(), NetherWalkStealth) > 0 and GetUnitAbilityLevel (GetEventDamageSource(), NetherWalkBash) > 0
  return b // checks if the Nathrezim attacked the enemy without the stealth but with the bash still active
endfunction

function Nether_Walk_C takes nothing returns boolean
  return GetSpellAbilityId() == NetherWalk
endfunction

// TRIGGERS ==================================================

function InitTrig_Sleep_Backstab takes nothing returns nothing
  local trigger cast = CreateTrigger ()
  local trigger bash = CreateTrigger ()
  
  call TriggerRegisterAnyUnitEventBJ (cast, EVENT_PLAYER_UNIT_SPELL_EFFECT)
  call TriggerRegisterAnyUnitEventBJ (bash, EVENT_PLAYER_UNIT_DAMAGED)
  
  call TriggerAddCondition (cast, Condition ( function Nether_Walk_C     ))
  call TriggerAddCondition (cast, Condition ( function Nether_Walk_Bash_C))
  
  call TriggerAddAction (cast, function Nether_Walk_A)
  call TriggerAddAction (bash, function Nether_Walk_Bash_A)
  
  set cast = null
  set bash = null
  
endfunction

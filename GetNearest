// I'm stubborn so instead of grabbing a premade GetNearest function online I'll make my own

/*************************************/

	//11 args!

	function FilterType takes unit whichUnit player playerArg, boolean ally, boolean enemy, boolean structure, boolean hero, boolean air, boolean ground, boolean summoned, boolean undead, boolean resistant, boolean immune returns boolean

		local unit u = whichUnit
		local player p = playerArg
		local boolean bool = false
		
		if IsUnitAlly (u, p) == ally and IsUnitEnemy(u, p) == enemy and IsUnitType(u, UNIT_TYPE_STRUCTURE) == structure and IsUnitType(u, UNIT_TYPE_HERO) == hero and IsUnitType(u, UNIT_TYPE_FLYING) == air and IsUnitType(u, UNIT_TYPE_GROUND) == ground and IsUnitType(u, UNIT_TYPE_SUMMONED) == summoned and IsUnitType(u, UNIT_TYPE_UNDEAD) == undead and IsUnitType(u, UNIT_TYPE_RESISTANT) == resistant and IsUnitType(u, UNIT_TYPE_MAGIC_IMMUNE) == immune then
			set bool = true
		else
			set bool = false
		endif
		
		set u = null
		set p = null
		
		return bool
		
	endfunction

	function GetNearestUnitByType takes real x, real y, real radius, player playerArg, boolean ally, boolean enemy, boolean structure, boolean hero, boolean air, boolean ground, boolean summoned, boolean undead, boolean resistant, boolean immune returns integer

		
		local unit temp
		local player p = playerArg
		local group g = CreateGroup()
		
		local real nearest = 0
		local real temp_distance
		
		local real temp_distanceX
		local real temp_distanceY
		
		local real temp_x
		local real temp_y
		
		local integer nearest_unit
		
		local boolean bool
		
		call GroupEnumUnitsInRange (g, x, y, radius, null ) 
		
		
		
		loop
			set temp = FirstOfGroup(g)
			exitwhen temp == null
			
			set bool = FilterType(temp, p, ally, enemy, structure, hero, air, ground, summoned, undead, resistant, immune)
			
			if bool then

				set temp_x = GetUnitX(temp)
				set temp_y = GetUnitY(temp)

				set temp_distanceX = temp_x - x
				set temp_distanceY = temp_y - y

				set temp_distance = SquareRoot(temp_distanceX * temp_distanceX + temp_distanceY * temp_distanceY)

				if nearest == 0 or temp_distance < nearest then
					set nearest = temp_distance
					set nearest_unit = GetUnitUserData(temp)
				endif
			endif
			call GroupRemoveUnit(g, temp)
		endloop
		
		call DestroyGroup(g)
		
		set temp = null
		set g = null
		set p = null
		
		return nearest_unit
		
	endfunction

	//

	function runFarSightTest takes nothing returns nothing
		
		local unit caster = GetTriggerUnit()
		local player p = GetOwningPlayer(caster)
		local real target_x
		local real target_y
		local real target_radius
		local string tempString
		local integer unitID
		
		if GetSpellAbilityId()  == 'AOfs' then
			
			set target_x = GetSpellTargetX()
			set target_y = GetSpellTargetY()
			set target_radius = 600
			
			set unitID = GetNearestUnitByType ( target_x, target_y, target_radius, p, true, false, false, false, true, true, false, false, false, false )
			set tempString = GetUnitName(udg_unit_array[unitID])
			call BJDebugMsg (tempString)
		endif
		
	endfunction

	//

	function InitTrig_Test takes nothing returns nothing

		local trigger t = CreateTrigger()
		
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		//call TriggerRegisterTimerEventSingle(t, 0.00)
		call TriggerAddAction(t, function runFarSightTest) 

		set t = null

	endfunction

	//

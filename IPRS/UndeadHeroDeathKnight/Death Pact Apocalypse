// higher health targets (or higher anything else, to make up for the sacrifice of big units)
// convert into more reanimated targets, minimum 1
// function

function Apocalypse takes nothing returns boolean
  
  local unit caster
  local unit target
  local unit temp
  local unit p
  local real x
  local real y
  local real hp
  local count = 1

  if GetSpellAbilityId() == 'Death Pact' then
    set caster = GetTriggerUnit()
    set target = GetSpellTargetUnit()
    set p  = GetOwningPlayer(caster)
    set x  = GetUnitX(target)
    set y  = GetUnitY(target)
    set hp = GetUnitState(target, UNIT_STATE_LIFE)
    set count = count + R2I( round(hp/250) )
    loop
      exitwhen = count == 0
      
      set temp = CreateUnit(p, 'h001', x, y, 0.)
      call UnitApplyTimedLife(temp, 'BTLF', 3.)
      call UnitAddAbility(temp, 'animate dead dummy')
      call IssueImmediateOrder(temp, "animatedead")
      call SetUnitAbilityLevel(temp, 'anim dead dummy', GetUnitAbilityLevel(caster, 'pact') )
      
      count = count - 1
    endloop
  endif
  
  set unit = null
  set temp = null
  set target = null
  set p = null
  
  return false
endfunction


// trigger

function InitTrig_Apocalypse takes nothing returns nothing

  local trigger t = CreateTrigger()
  
  call TriggerRegisterAnyUnitEventBJ (t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
  
  call TriggerAddCondition (t, condition ( function Apocalypse ) )

endfunction
//

// I'm stubborn so instead of grabbing a premade GetNearest function online I'll make my own
// I just need to read these later first 
// https://www.hiveworkshop.com/threads/how-to-pick-units-in-jass.269640/
// https://www.thehelper.net/threads/groupenumunitsinrange-explanation.127687/
/*************************************/

// ITS SHIT
// SHIT SHIT SHIT
// GOTTA TRY ANOTHER APPROACH SINCE THIS FAGGOT GAME WON'T LET ME PASS ARGUMENTS TO ENUM


	//11 args!

	function Enum takes player playerArg, boolean ally, boolean enemy, boolean structure, boolean hero, boolean air, boolean ground, boolean summoned, boolean undead, boolean resistant, boolean immune returns boolean

		local unit u = GetFilterUnit()
		local player p = playerArg
		local boolean bool = false
		
		if IsUnitAlly (u, p) == ally and IsUnitEnemy(u, p) == enemy and IsUnitType(u, UNIT_TYPE_STRUCTURE) == structure and IsUnitType(u, UNIT_TYPE_HERO) == hero and IsUnitType(u, UNIT_TYPE_FLYING) == air and IsUnitType(u, UNIT_TYPE_GROUND) == ground and IsUnitType(u, UNIT_TYPE_SUMMONED) == summoned and IsUnitType(u, UNIT_TYPE_UNDEAD) == undead and IsUnitType(u, UNIT_TYPE_RESISTANT) == resistant and IsUnitType(u, UNIT_TYPE_MAGIC_IMMUNE) == immune then
			set bool = true
		else
			set bool = false
		endif
		return bool
		
	endfunction

	function GetNearestUnitByType takes real x, real y, real radius, player playerArg, boolean ally, boolean enemy, boolean structure, boolean hero, boolean air, boolean ground, boolean summoned, boolean undead, boolean resistant, boolean immune returns unit

		local unit nearest_unit
		local unit temp
		local player p = playerArg
		local group g = CreateGroup()
		
		local real nearest = 0
		local real temp_distance
		
		local real temp_distanceX
		local real temp_distanceY
		
		local real temp_x
		local real temp_y
		
		//call GroupEnumUnitsInRange (g, x, y, radius, Filter(Enum (p, ally, enemy, structure, hero, air, ground, summoned, undead, resistant, immune) ) )
		call GroupEnumUnitsInRange (g, x, y, radius, Filter(function Enum) )
		
		
		loop
			set temp = FirstOfGroup(g)
			exitwhen temp == null
			
			set temp_x = GetUnitX(temp)
			set temp_y = GetUnitY(temp)
			
			set temp_distanceX = temp_x - x
			set temp_distanceY = temp_y - y
			
			set temp_distance = SquareRoot(temp_distanceX * temp_distanceX + temp_distanceY * temp_distanceY)
			
			if nearest == 0 or temp_distance < nearest then
				set nearest = temp_distance
				set nearest_unit = temp
			endif
			
			call GroupRemoveUnit(g, temp)
		endloop
		
		call DestroyGroup(g)
		
		set temp = null
		set g = null
		set p = null
		
		return nearest_unit
		
	endfunction

	//

	function runFarSightTest takes nothing returns nothing
		
		local unit caster = GetTriggerUnit()
		local player p = GetOwningPlayer(caster)
		local real target_x
		local real target_y
		local real target_radius
		
		if GetSpellAbilityId()  == 'AOfs' then
			
			set target_x = GetSpellTargetX()
			set target_y = GetSpellTargetY()
			set target_radius = 600
			
			
			call GetNearestUnitByType ( target_x, target_y, target_radius, p, true, false, false, false, true, true, false, false, false, false )
		endif
		
	endfunction

	//

	function InitTrig_Test takes nothing returns nothing

		local trigger t = CreateTrigger()
		
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		//call TriggerRegisterTimerEventSingle(t, 0.00)
		call TriggerAddAction(t, function runFarSightTest) 

		set t = null

	endfunction

	//
